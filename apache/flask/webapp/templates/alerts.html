{% extends 'base.html' %}

{% block content %}

<section>
<div class="container">
	<h2>Alerting Table</h2>
	<p>These are alerts generated by Sweet Security</p>
	<table class="table table-condensed">
		<thead>
			<tr>
				<th>Source</th>
				<th>Message</th>
				<th>Device</th>
				<th>Date</th>
				<th></th>
			</tr>
		</thead>
		<tbody>
{% for alert in myAlerts %}
			<tr>
				<td>{{alert['_source']['source']|safe}}</td>
				<td>{{alert['_source']['message']|safe}}</td>
				<td>{% if alert['_source']['mac'] == "system" %}<a href='/settings'>Server</a>{%else%}<a href='/device/{{alert['_source']['mac']|safe}}'>{{alert['_source']['mac']|safe}}</a>{%endif%}</td>
				<td>{{alert['_source']['firstSeen']|safe}}</td>
				<td><button type="button" class="btn btn-primary btn-xs" onclick="addressAlert(this,'{{alert['_id']}}')">Delete</button></td>
			</tr>
{% endfor %}
		</tbody>
	</table>
	<br/><br/>
	<a href="/alerts/addressed">View Old Alerts Here...</a>
</div>

<script>
function addressAlert(checkboxElem,logID) {
  $.post('/alerts/address',
      { 
        'logID': logID,
        'csrf_token': '{{ csrf_token() }}'
      },
      function (response, status) {
        window.location.reload();
      }
    );
}
</script>

</section>

{% endblock %}
